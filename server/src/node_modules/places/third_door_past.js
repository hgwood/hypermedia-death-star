"use strict"

const _ = require("lodash")
const persistence = require("persistence")
const digicode = require("places/digicode")
const thirdDoor = require("places/third_door")

module.exports = {
  "title": thirdDoor.title,
  "description": thirdDoor.description,
  "links": [
    {
      "description": thirdDoor.links[0].description,
      "href": "corridor_past",
      "rel": thirdDoor.links[0].rel
    }
  ],
  "actions": [_.defaults({handler}, thirdDoor.actions[1])]
}

function handler(place, action, request, response) {
  if (request.body.text === digicode.code) {
    persistence.with("corridor_past", function(corridorPast) {
      corridorPast.codeWrittenOnThirdDoor = true
    })
  }
  thirdDoor.actions[1].handler(place, action, request, response)
}
