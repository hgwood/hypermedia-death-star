"use strict"

const persistence = require("persistence")

module.exports = {
  "title": "...",
  "description": "L'écran a à peine affiché 0 que la porte d'entrée s'ouvre. Vous l'entendez avant de le voir. Dark Vador est là, devant vous, sabre laser armé. L'effroi vous envahit. Tout est perdu. A moins que vous ne connaissiez bien vos méthodes HTTP.",
  "locationAfterDelete": "control_room",
  "hook": hook
}

function hook(app, uriTemplate, place, placeId) {
  app.delete(uriTemplate, function(request, response) {
    response.status(204).location(place.locationAfterDelete).send()
    persistence.with("vader", function(vader) {
      vader.deleted = true
    })
    persistence.with("control_room", function(controlRoom) {
      controlRoom.links[0].hidden = true
      controlRoom.links[2].hidden = true
      controlRoom.links[3].hidden = true
      controlRoom.links[4].hidden = false
    })
  })
}
