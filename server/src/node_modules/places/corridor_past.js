"use strict"

const persistence = require("persistence")
const corridor = require("places/corridor")
const sendPlace = require("send-place")

module.exports = {
  "title": corridor.title,
  "description": corridor.description,
  "links": [
    {
      "description": "Aller dans la salle de contrôle",
      "href": "control_room_past",
      "rel": ["move", "backward", "back", "prev"]
    },
    {
      "description": "Aller dans le hangar",
      "href": "landing_bay_past",
      "rel": ["move", "backward", "back", "prev"]
    },
    {
      "description": "Examiner la troisième porte",
      "href": "third_door_past",
      "rel": ["look", "detail", "next"]
    }
  ],
  "locationAfterCodeWrittenOnThirdDoor": "paradox",
  "handler": handler
}

function handler(place, request, response) {
  persistence.with("corridor_past", function(corridorPast) {
    if (corridorPast.codeWrittenOnThirdDoor) {
      response.status(303).location(corridorPast.locationAfterCodeWrittenOnThirdDoor).send()
    } else {
      sendPlace(response, corridorPast)
    }
  })
}
